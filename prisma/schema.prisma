generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextIndex", "fullTextSearch"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String              @id @default(cuid())
  email                String              @unique
  username             String?             @unique
  passwordHash         String?
  name                 String?
  bio                  String?             @db.Text
  image                String?             @db.Text
  role                 Role                @default(USER)
  currentWeight        Float?
  targetWeight         Float?
  height               Float?
  emailVerified        DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  isBanned             Boolean             @default(false)
  coins                Int                 @default(0)
  lastCheckIn          DateTime?
  level                Int                 @default(1)
  reputationScore      Int                 @default(0)
  streak               Int                 @default(0)
  xp                   Int                 @default(0)
  banReason            String?             @db.Text
  bannedUntil          DateTime?
  activeTitle          String?
  coinBoostUntil       DateTime?
  customEmoji          String?
  nameColor            String?
  profileBadge         String?
  profileFrame         String?
  profileTheme         String?
  streakFreezeCount    Int                 @default(0)
  xpBoostUntil         DateTime?
  accounts             Account[]
  blogComments         BlogComment[]
  blogPosts            BlogPost[]
  coinTransactions     CoinTransaction[]
  comments             Comment[]
  confessionEmpathies  ConfessionEmpathy[]
  confessionReports    ConfessionReport[]
  confessions          Confession[]
  resolvedAppeals      ContentAppeal[]     @relation("AppealResolver")
  appeals              ContentAppeal[]
  favorites            Favorite[]
  followers            Follow[]            @relation("UserFollowers")
  following            Follow[]            @relation("UserFollowing")
  groupMemberships     GroupMember[]
  groupPosts           GroupPost[]
  createdGroups        Group[]             @relation("GroupCreator")
  guildJoinRequests    GuildJoinRequest[]
  guildMemberships     GuildMember[]
  ledGuilds            Guild[]             @relation("GuildLeader")
  likes                Like[]
  receivedMessages     Message[]           @relation("ReceivedMessages")
  sentMessages         Message[]           @relation("SentMessages")
  notifications        Notification[]
  passwordResets       PasswordReset[]
  plans                Plan[]
  photos               ProgressPhoto[]
  pushSubscriptions    PushSubscription[]
  recipeComments       RecipeComment[]
  recipeLikes          RecipeLike[]
  recipes              Recipe[]
  referralCode         ReferralCode?
  referralsReceived    Referral[]          @relation("ReferredUser")
  referralsMade        Referral[]          @relation("ReferrerUser")
  sessions             Session[]
  streakRecoveries     StreakRecovery[]
  badges               UserBadge[]
  battlePasses         UserBattlePass[]
  cohorts              UserCohort[]        @relation("UserCohorts")
  quests               UserDailyQuest[]
  leagueParticipations UserLeague[]
  purchases            UserPurchase[]
  weightLogs           WeightLog[]
  conversations        Conversation[]      @relation("conversationparticipants")
  foodSins             FoodSin[]
  sinBadges            UserSinBadge[]
  sinChallenges        UserSinChallenge[]
  sinWeeklySummaries   SinWeeklySummary[]

  @@index([email])
  @@index([username])
  @@index([role])
  @@index([createdAt])
  @@index([xp])
  @@index([level])
  @@index([reputationScore])
  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Plan {
  id               String         @id @default(cuid())
  slug             String         @unique
  title            String
  description      String         @db.Text
  authorId         String
  duration         Int
  targetWeightLoss Float?
  difficulty       Difficulty     @default(medium)
  tags             String?        @db.Text
  authorStory      String?        @db.Text
  authorWeightLoss Float?
  authorDuration   Int?
  beforePhotoUrl   String?
  afterPhotoUrl    String?
  status           PlanStatus     @default(pending)
  views            Int            @default(0)
  likesCount       Int            @default(0)
  commentsCount    Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  publishedAt      DateTime?
  rejectionReason  String?        @db.Text
  averageRating    Float          @default(0)
  ratingCount      Int            @default(0)
  comments         Comment[]
  likes            Like[]
  days             PlanDay[]
  progress         PlanProgress[]
  ratings          PlanRating[]
  author           User           @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([slug])
  @@index([authorId, createdAt])
  @@index([status, createdAt])
  @@index([publishedAt])
  @@index([averageRating])
  @@fulltext([title, description])
  @@map("plans")
}

model PlanRating {
  id        String   @id @default(cuid())
  userId    String
  planId    String
  rating    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  plan      Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([userId, planId])
  @@index([planId])
  @@index([userId])
  @@map("plan_ratings")
}

model PlanProgress {
  id          String   @id @default(cuid())
  userId      String
  planId      String
  currentDay  Int      @default(0)
  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  plan        Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([userId, planId])
  @@index([planId])
  @@index([userId])
  @@map("plan_progress")
}

model PlanDay {
  id        String  @id @default(cuid())
  planId    String
  dayNumber Int
  breakfast String? @db.Text
  snack1    String? @db.Text
  lunch     String? @db.Text
  snack2    String? @db.Text
  dinner    String? @db.Text
  notes     String? @db.Text
  plan      Plan    @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, dayNumber])
  @@index([planId])
  @@map("plan_days")
}

model Recipe {
  id              String          @id @default(cuid())
  slug            String          @unique
  title           String
  description     String          @db.Text
  authorId        String
  ingredients     String          @db.Text
  instructions    String          @db.Text
  prepTime        Int?
  cookTime        Int?
  servings        Int             @default(1)
  calories        Float?
  protein         Float?
  carbs           Float?
  fat             Float?
  fiber           Float?
  category        RecipeCategory  @default(main)
  mealType        MealType?
  tags            String?         @db.Text
  videoUrl        String?
  difficulty      Difficulty      @default(medium)
  status          PlanStatus      @default(pending)
  views           Int             @default(0)
  likesCount      Int             @default(0)
  commentsCount   Int             @default(0)
  isFeatured      Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  publishedAt     DateTime?
  images          String?         @db.Text
  rejectionReason String?         @db.Text
  comments        RecipeComment[]
  likes           RecipeLike[]
  author          User            @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([slug])
  @@index([authorId, createdAt])
  @@index([status, createdAt])
  @@index([publishedAt])
  @@index([category, status])
  @@fulltext([title, description])
  @@map("recipes")
}

model RecipeComment {
  id        String        @id @default(cuid())
  recipeId  String
  authorId  String
  body      String        @db.Text
  status    CommentStatus @default(visible)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  author    User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  recipe    Recipe        @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId, createdAt])
  @@index([authorId])
  @@index([status, createdAt])
  @@map("recipe_comments")
}

model RecipeLike {
  id        String   @id @default(cuid())
  recipeId  String
  userId    String
  createdAt DateTime @default(now())
  recipe    Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId])
  @@index([recipeId])
  @@index([userId])
  @@map("recipe_likes")
}

model Comment {
  id         String        @id @default(cuid())
  authorId   String
  targetType TargetType
  targetId   String
  body       String        @db.Text
  status     CommentStatus @default(visible)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  author     User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  plan       Plan          @relation(fields: [targetId], references: [id], onDelete: Cascade)

  @@index([targetType, targetId, createdAt])
  @@index([authorId])
  @@index([status, createdAt])
  @@index([targetId], map: "comments_targetId_fkey")
  @@map("comments")
}

model Like {
  id         String     @id @default(cuid())
  userId     String
  targetType TargetType
  targetId   String
  createdAt  DateTime   @default(now())
  plan       Plan       @relation(fields: [targetId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, targetType, targetId])
  @@index([targetType, targetId])
  @@index([userId])
  @@index([targetId], map: "likes_targetId_fkey")
  @@map("likes")
}

model Favorite {
  id         String     @id @default(cuid())
  userId     String
  targetType TargetType
  targetId   String
  createdAt  DateTime   @default(now())
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, targetType, targetId])
  @@index([targetType, targetId])
  @@index([userId])
  @@map("favorites")
}

model Follow {
  id        String   @id @default(cuid())
  userId    String
  targetId  String
  createdAt DateTime @default(now())
  target    User     @relation("UserFollowers", fields: [targetId], references: [id], onDelete: Cascade)
  user      User     @relation("UserFollowing", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, targetId])
  @@index([userId])
  @@index([targetId])
  @@map("follows")
}

model WeightLog {
  id        String   @id @default(cuid())
  userId    String
  weight    Float
  date      DateTime @default(now())
  note      String?  @db.Text
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@map("weight_logs")
}

model ProgressPhoto {
  id            String    @id @default(cuid())
  userId        String
  photoUrl      String
  weight        Float?
  type          PhotoType @default(progress)
  caption       String?   @db.Text
  likesCount    Int       @default(0)
  commentsCount Int       @default(0)
  createdAt     DateTime  @default(now())
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("progress_photos")
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  type       NotificationType
  title      String
  body       String           @db.Text
  targetType TargetType?
  targetId   String?
  read       Boolean          @default(false)
  createdAt  DateTime         @default(now())
  user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read, createdAt])
  @@map("notifications")
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String   @db.Text
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@map("settings")
}

model RolePermission {
  id          String   @id @default(cuid())
  role        String
  resource    String
  action      String
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([role, resource, action])
  @@index([role])
  @@map("role_permissions")
}

model ApiKey {
  id          String    @id @default(cuid())
  name        String
  key         String    @unique
  permissions String    @db.Text
  isActive    Boolean   @default(true)
  lastUsedAt  DateTime?
  expiresAt   DateTime?
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([key])
  @@index([isActive])
  @@map("api_keys")
}

model PlanView {
  id        String   @id @default(cuid())
  planId    String
  userId    String?
  ipAddress String?
  viewedAt  DateTime @default(now())

  @@index([planId, userId, viewedAt])
  @@index([planId, ipAddress, viewedAt])
  @@map("plan_views")
}

model Conversation {
  id            String    @id @default(cuid())
  lastMessageAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  messages      Message[]
  users         User[]    @relation("conversationparticipants")

  @@index([lastMessageAt])
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  receiverId     String
  body           String       @db.Text
  read           Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  receiver       User         @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([senderId])
  @@index([receiverId])
  @@index([read])
  @@map("messages")
}

model Badge {
  id          String        @id @default(cuid())
  key         String        @unique
  name        String
  description String        @db.Text
  icon        String
  category    BadgeCategory @default(achievement)
  rarity      BadgeRarity   @default(common)
  xpReward    Int           @default(0)
  coinReward  Int           @default(0)
  isActive    Boolean       @default(true)
  sortOrder   Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  users       UserBadge[]

  @@index([category])
  @@index([rarity])
  @@index([isActive])
  @@map("badges")
}

model UserBadge {
  id       String   @id @default(cuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())
  badge    Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId, earnedAt])
  @@index([badgeId])
  @@map("user_badges")
}

model DailyQuest {
  id          String           @id @default(cuid())
  key         String           @unique
  title       String
  description String           @db.Text
  icon        String
  xpReward    Int              @default(10)
  coinReward  Int              @default(5)
  type        QuestType        @default(daily)
  target      Int              @default(1)
  isActive    Boolean          @default(true)
  sortOrder   Int              @default(0)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  userQuests  UserDailyQuest[]

  @@index([type])
  @@index([isActive])
  @@map("daily_quests")
}

model UserDailyQuest {
  id          String     @id @default(cuid())
  userId      String
  questId     String
  progress    Int        @default(0)
  completed   Boolean    @default(false)
  completedAt DateTime?
  date        DateTime   @default(now())
  createdAt   DateTime   @default(now())
  quest       DailyQuest @relation(fields: [questId], references: [id], onDelete: Cascade)
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, questId, date])
  @@index([userId, date])
  @@index([questId])
  @@index([completed])
  @@map("user_daily_quests")
}

model CoinTransaction {
  id          String              @id @default(cuid())
  userId      String
  amount      Int
  type        CoinTransactionType
  description String
  metadata    String?             @db.Text
  createdAt   DateTime            @default(now())
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([type])
  @@map("coin_transactions")
}

model ShopItem {
  id          String         @id @default(cuid())
  key         String         @unique
  name        String
  description String         @db.Text
  icon        String
  category    ShopCategory   @default(cosmetic)
  price       Int
  stock       Int?
  isActive    Boolean        @default(true)
  sortOrder   Int            @default(0)
  metadata    String?        @db.Text
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  purchases   UserPurchase[]

  @@index([category])
  @@index([isActive])
  @@map("shop_items")
}

model UserPurchase {
  id          String   @id @default(cuid())
  userId      String
  itemId      String
  quantity    Int      @default(1)
  totalPrice  Int
  purchasedAt DateTime @default(now())
  item        ShopItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, purchasedAt])
  @@index([itemId])
  @@map("user_purchases")
}

model Season {
  id           String       @id @default(cuid())
  name         String
  description  String?      @db.Text
  startDate    DateTime
  endDate      DateTime
  isActive     Boolean      @default(false)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  battlePasses BattlePass[]
  leagues      League[]
  userLeagues  UserLeague[]

  @@index([isActive])
  @@index([startDate, endDate])
  @@map("seasons")
}

model League {
  id          String       @id @default(cuid())
  seasonId    String
  tier        LeagueTier
  name        String
  description String?      @db.Text
  minPoints   Int          @default(0)
  maxPoints   Int?
  icon        String?
  rewards     String?      @db.Text
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  season      Season       @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  users       UserLeague[]

  @@unique([seasonId, tier])
  @@index([seasonId])
  @@map("leagues")
}

model UserLeague {
  id        String   @id @default(cuid())
  userId    String
  leagueId  String
  seasonId  String
  points    Int      @default(0)
  rank      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  league    League   @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  season    Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, seasonId])
  @@index([seasonId, points])
  @@index([leagueId, points])
  @@map("user_leagues")
}

model Guild {
  id              String             @id @default(cuid())
  name            String             @unique
  slug            String             @unique
  description     String?            @db.Text
  icon            String?
  leaderId        String
  memberCount     Int                @default(1)
  totalXP         Int                @default(0)
  level           Int                @default(1)
  isPublic        Boolean            @default(true)
  maxMembers      Int                @default(50)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  publishedAt     DateTime?
  rejectionReason String?            @db.Text
  status          GroupStatus        @default(pending)
  category        String?
  color           String?
  monthlyGoal     String?
  rules           String?            @db.Text
  joinRequests    GuildJoinRequest[]
  members         GuildMember[]
  leader          User               @relation("GuildLeader", fields: [leaderId], references: [id])

  @@index([slug])
  @@index([leaderId])
  @@index([totalXP])
  @@index([status, createdAt])
  @@index([category])
  @@map("guilds")
}

model GuildMember {
  id       String          @id @default(cuid())
  guildId  String
  userId   String
  role     GuildMemberRole @default(member)
  xpEarned Int             @default(0)
  joinedAt DateTime        @default(now())
  guild    Guild           @relation(fields: [guildId], references: [id], onDelete: Cascade)
  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([guildId, userId])
  @@index([userId])
  @@index([guildId, xpEarned])
  @@map("guild_members")
}

model GuildJoinRequest {
  id        String                 @id @default(cuid())
  guildId   String
  userId    String
  message   String?                @db.Text
  status    GuildJoinRequestStatus @default(pending)
  createdAt DateTime               @default(now())
  updatedAt DateTime               @updatedAt
  guild     Guild                  @relation(fields: [guildId], references: [id], onDelete: Cascade)
  user      User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([guildId, userId])
  @@index([guildId, status])
  @@index([userId])
  @@map("guild_join_requests")
}

model BattlePass {
  id          String             @id @default(cuid())
  seasonId    String
  tier        BattlePassTier     @default(free)
  name        String
  description String?            @db.Text
  price       Int                @default(0)
  maxLevel    Int                @default(50)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  rewards     BattlePassReward[]
  season      Season             @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  users       UserBattlePass[]

  @@unique([seasonId, tier])
  @@index([seasonId])
  @@map("battle_passes")
}

model BattlePassReward {
  id          String     @id @default(cuid())
  passId      String
  level       Int
  rewardType  RewardType
  rewardId    String?
  rewardValue Int?
  description String
  icon        String?
  createdAt   DateTime   @default(now())
  pass        BattlePass @relation(fields: [passId], references: [id], onDelete: Cascade)

  @@unique([passId, level])
  @@index([passId])
  @@map("battle_pass_rewards")
}

model UserBattlePass {
  id           String     @id @default(cuid())
  userId       String
  passId       String
  currentLevel Int        @default(1)
  xpEarned     Int        @default(0)
  isPremium    Boolean    @default(false)
  purchasedAt  DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  pass         BattlePass @relation(fields: [passId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, passId])
  @@index([passId, currentLevel])
  @@map("user_battle_passes")
}

model StreakRecovery {
  id          String   @id @default(cuid())
  userId      String
  streakLost  Int
  coinsCost   Int
  recoveredAt DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, recoveredAt])
  @@map("streak_recoveries")
}

model ReferralCode {
  id        String   @id @default(cuid())
  userId    String   @unique
  code      String   @unique
  usedCount Int      @default(0)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
  @@map("referral_codes")
}

model Referral {
  id          String         @id @default(cuid())
  referrerId  String
  referredId  String
  bonusCoins  Int            @default(50)
  status      ReferralStatus @default(pending)
  createdAt   DateTime       @default(now())
  completedAt DateTime?
  referred    User           @relation("ReferredUser", fields: [referredId], references: [id], onDelete: Cascade)
  referrer    User           @relation("ReferrerUser", fields: [referrerId], references: [id], onDelete: Cascade)

  @@unique([referrerId, referredId])
  @@index([referrerId])
  @@index([referredId])
  @@index([status])
  @@map("referrals")
}

model Group {
  id              String        @id @default(cuid())
  name            String
  slug            String        @unique
  description     String?       @db.Text
  image           String?
  category        GroupCategory @default(general)
  creatorId       String
  memberCount     Int           @default(1)
  postCount       Int           @default(0)
  isPublic        Boolean       @default(true)
  maxMembers      Int?
  tags            String?       @db.Text
  rules           String?       @db.Text
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  publishedAt     DateTime?
  rejectionReason String?       @db.Text
  status          GroupStatus   @default(pending)
  members         GroupMember[]
  posts           GroupPost[]
  creator         User          @relation("GroupCreator", fields: [creatorId], references: [id])

  @@index([slug])
  @@index([creatorId])
  @@index([category])
  @@index([isPublic])
  @@index([status, createdAt])
  @@fulltext([name, description])
  @@map("groups")
}

model GroupMember {
  id       String          @id @default(cuid())
  groupId  String
  userId   String
  role     GroupMemberRole @default(member)
  joinedAt DateTime        @default(now())
  group    Group           @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([userId])
  @@index([groupId, joinedAt])
  @@map("group_members")
}

model GroupPost {
  id         String        @id @default(cuid())
  groupId    String
  authorId   String
  title      String?
  body       String        @db.Text
  images     String?       @db.Text
  likesCount Int           @default(0)
  status     CommentStatus @default(visible)
  isPinned   Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  author     User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  group      Group         @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId, createdAt])
  @@index([authorId])
  @@index([status])
  @@index([isPinned, createdAt])
  @@map("group_posts")
}

model ContentAppeal {
  id          String        @id @default(cuid())
  userId      String
  contentType AppealContent
  contentId   String
  reason      String        @db.Text
  status      AppealStatus  @default(pending)
  priority    Int           @default(0)
  adminNote   String?       @db.Text
  resolvedBy  String?
  resolvedAt  DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resolver    User?         @relation("AppealResolver", fields: [resolvedBy], references: [id])
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([status, priority])
  @@index([contentType, contentId])
  @@index([createdAt])
  @@index([resolvedBy], map: "content_appeals_resolvedBy_fkey")
  @@map("content_appeals")
}

model CohortDefinition {
  id          String            @id @default(cuid())
  name        String
  description String?           @db.Text
  filters     String            @db.LongText
  isActive    Boolean           @default(true)
  createdBy   String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  metrics     RetentionMetric[]
  users       UserCohort[]

  @@index([isActive, createdAt])
  @@index([createdAt])
  @@map("cohort_definitions")
}

model UserCohort {
  id       String           @id @default(cuid())
  cohortId String
  userId   String
  addedAt  DateTime         @default(now())
  cohort   CohortDefinition @relation(fields: [cohortId], references: [id], onDelete: Cascade)
  user     User             @relation("UserCohorts", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([cohortId, userId])
  @@index([userId])
  @@index([cohortId, addedAt])
  @@map("user_cohorts")
}

model RetentionMetric {
  id        String           @id @default(cuid())
  cohortId  String
  date      DateTime
  dayNumber Int
  retained  Int
  total     Int
  rate      Float
  createdAt DateTime         @default(now())
  cohort    CohortDefinition @relation(fields: [cohortId], references: [id], onDelete: Cascade)

  @@unique([cohortId, date, dayNumber])
  @@index([cohortId, dayNumber])
  @@index([date])
  @@map("retention_metrics")
}

model ABTest {
  id          String             @id @default(cuid())
  name        String
  description String?            @db.Text
  variants    String             @db.LongText
  isActive    Boolean            @default(true)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  assignments ABTestAssignment[]

  @@index([isActive, startDate])
  @@map("ab_tests")
}

model ABTestAssignment {
  id        String   @id @default(cuid())
  testId    String
  userId    String
  variant   String
  createdAt DateTime @default(now())
  test      ABTest   @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@unique([testId, userId])
  @@index([userId])
  @@index([testId, variant])
  @@map("ab_test_assignments")
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
  @@map("password_resets")
}

model PushSubscription {
  id        String   @id @default(cuid())
  userId    String
  endpoint  String   @db.VarChar(500)
  p256dh    String   @db.Text
  auth      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, endpoint])
  @@index([userId])
  @@map("push_subscriptions")
}

model Page {
  id          String     @id @default(cuid())
  slug        String     @unique
  title       String
  content     String     @db.LongText
  metaTitle   String?
  metaDesc    String?    @db.Text
  status      PageStatus @default(draft)
  isPublished Boolean    @default(false)
  sortOrder   Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  publishedAt DateTime?

  @@index([slug])
  @@index([status])
  @@index([isPublished])
  @@map("pages")
}

model FooterLink {
  id        String       @id @default(cuid())
  title     String
  url       String
  column    FooterColumn @default(company)
  sortOrder Int          @default(0)
  isActive  Boolean      @default(true)
  openInNew Boolean      @default(false)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@index([column, sortOrder])
  @@index([isActive])
  @@map("footer_links")
}

model FooterSocial {
  id        String   @id @default(cuid())
  platform  String
  url       String
  icon      String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
  @@index([isActive])
  @@map("footer_socials")
}

model FooterSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("footer_settings")
}

model ContactMessage {
  id          String               @id @default(cuid())
  name        String
  email       String
  subject     String
  message     String               @db.Text
  status      ContactMessageStatus @default(new)
  response    String?              @db.Text
  respondedBy String?
  respondedAt DateTime?
  ipAddress   String?
  userAgent   String?              @db.Text
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  @@index([status, createdAt])
  @@index([email])
  @@map("contact_messages")
}

model Confession {
  id              String              @id @default(cuid())
  userId          String
  content         String              @db.Text
  category        ConfessionCategory
  aiResponse      String?             @db.Text
  aiTone          AITone?
  telafiBudget    String?             @db.Text
  empathyCount    Int                 @default(0)
  status          ConfessionStatus    @default(pending)
  rejectionReason String?             @db.Text
  isPopular       Boolean             @default(false)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  publishedAt     DateTime?
  empathies       ConfessionEmpathy[]
  reports         ConfessionReport[]
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([status, createdAt])
  @@index([category, publishedAt])
  @@index([isPopular, empathyCount])
  @@map("confessions")
}

model ConfessionEmpathy {
  id           String     @id @default(cuid())
  confessionId String
  userId       String
  createdAt    DateTime   @default(now())
  confession   Confession @relation(fields: [confessionId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([confessionId, userId])
  @@index([userId, createdAt])
  @@index([confessionId])
  @@map("confession_empathies")
}

model ConfessionReport {
  id           String     @id @default(cuid())
  confessionId String
  userId       String
  reason       String     @db.Text
  createdAt    DateTime   @default(now())
  confession   Confession @relation(fields: [confessionId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([confessionId, userId])
  @@index([confessionId, createdAt])
  @@index([userId], map: "confession_reports_userId_fkey")
  @@map("confession_reports")
}

model SeasonalTheme {
  id        String   @id @default(cuid())
  name      String
  category  String
  icon      String
  startDate DateTime
  endDate   DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([isActive, startDate, endDate])
  @@map("seasonal_themes")
}

model BlogPost {
  id              String        @id @default(cuid())
  title           String
  slug            String        @unique
  content         String        @db.LongText
  excerpt         String?       @db.VarChar(300)
  coverImage      String?
  coverImageAlt   String?
  metaTitle       String?
  metaDescription String?       @db.VarChar(160)
  status          BlogStatus    @default(DRAFT)
  featured        Boolean       @default(false)
  featuredOrder   Int?
  viewCount       Int           @default(0)
  readingTime     Int
  authorId        String
  categoryId      String
  publishedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  deletedAt       DateTime?
  comments        BlogComment[]
  author          User          @relation(fields: [authorId], references: [id])
  category        BlogCategory  @relation(fields: [categoryId], references: [id])
  blog_tags       BlogTag[]     @relation("blogposttoblogtag")

  @@index([slug])
  @@index([status, publishedAt])
  @@index([categoryId])
  @@index([featured])
  @@index([authorId])
  @@index([createdAt])
  @@fulltext([title, content])
  @@map("blog_posts")
}

model BlogCategory {
  id          String     @id @default(cuid())
  name        String     @unique
  slug        String     @unique
  description String?    @db.Text
  icon        String?
  color       String?
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  posts       BlogPost[]

  @@index([slug])
  @@index([order])
  @@map("blog_categories")
}

model BlogTag {
  id         String     @id @default(cuid())
  name       String     @unique
  slug       String     @unique
  createdAt  DateTime   @default(now())
  blog_posts BlogPost[] @relation("blogposttoblogtag")

  @@index([slug])
  @@index([name])
  @@map("blog_tags")
}

model BlogComment {
  id        String            @id @default(cuid())
  content   String            @db.Text
  status    BlogCommentStatus @default(PENDING)
  postId    String
  userId    String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  post      BlogPost          @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User              @relation(fields: [userId], references: [id])

  @@index([postId, status])
  @@index([userId])
  @@index([status, createdAt])
  @@index([createdAt])
  @@map("blog_comments")
}

enum Role {
  USER
  ADMIN
}

enum PlanStatus {
  draft
  pending
  under_review
  published
  rejected
}

enum Difficulty {
  easy
  medium
  hard
}

enum CommentStatus {
  pending
  visible
  hidden
}

enum TargetType {
  plan
  photo
}

enum PhotoType {
  before
  after
  progress
}

enum NotificationType {
  like
  comment
  follow
  plan_approved
  plan_rejected
  message
}

enum RecipeCategory {
  breakfast
  lunch
  dinner
  snack
  dessert
  drink
  main
  side
  salad
  soup
}

enum MealType {
  breakfast
  lunch
  dinner
  snack
}

enum BadgeCategory {
  achievement
  milestone
  social
  special
}

enum BadgeRarity {
  common
  rare
  epic
  legendary
}

enum QuestType {
  daily
  weekly
  special
}

enum CoinTransactionType {
  quest_reward
  badge_reward
  purchase
  referral_bonus
  streak_recovery
  admin_grant
  level_up
  guild_reward
  league_promotion
}

enum ShopCategory {
  cosmetic
  boost
  recovery
  special
}

enum LeagueTier {
  bronze
  silver
  gold
  platinum
  diamond
}

enum GuildMemberRole {
  leader
  officer
  member
}

enum GuildJoinRequestStatus {
  pending
  approved
  rejected
}

enum BattlePassTier {
  free
  premium
}

enum RewardType {
  badge
  coins
  xp
  item
}

enum ReferralStatus {
  pending
  completed
  expired
}

enum GroupCategory {
  general
  motivation
  recipes
  exercise
  support
  age_based
  goal_based
  lifestyle
}

enum GroupMemberRole {
  creator
  admin
  moderator
  member
}

enum GroupStatus {
  pending
  published
  rejected
}

enum AppealContent {
  plan
  recipe
  comment
  recipe_comment
  group_post
}

enum AppealStatus {
  pending
  under_review
  approved
  rejected
}

enum PageStatus {
  draft
  published
  archived
}

enum FooterColumn {
  company
  support
  legal
  community
}

enum ContactMessageStatus {
  new
  read
  responded
  archived
  spam
}

enum ConfessionCategory {
  night_attack
  special_occasion
  stress_eating
  social_pressure
  no_regrets
  seasonal
}

enum AITone {
  empathetic
  humorous
  motivational
  realistic
}

enum ConfessionStatus {
  pending
  published
  rejected
  hidden
}

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum BlogCommentStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM
}

// ============================================
// YEMEK GÃœNAH SAYACI (FOOD SIN TRACKER) SYSTEM
// ============================================

model FoodSin {
  id           String      @id @default(cuid())
  userId       String
  sinType      SinType
  note         String?     @db.Text
  emoji        String      @db.VarChar(10)
  sinDate      DateTime    @default(now())
  reactionText String?     @db.Text
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, sinDate])
  @@index([sinType, sinDate])
  @@index([userId, createdAt])
  @@map("food_sins")
}

model SinReaction {
  id          String   @id @default(cuid())
  sinType     SinType
  reactionText String  @db.Text
  isActive    Boolean  @default(true)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([sinType, isActive])
  @@map("sin_reactions")
}

model SinBadge {
  id          String   @id @default(cuid())
  key         String   @unique
  name        String
  description String   @db.Text
  icon        String
  sinType     SinType?
  requirement String   @db.Text
  xpReward    Int      @default(0)
  coinReward  Int      @default(0)
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       UserSinBadge[]

  @@index([isActive])
  @@index([sinType])
  @@map("sin_badges")
}

model UserSinBadge {
  id       String   @id @default(cuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())
  badge    SinBadge @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId, earnedAt])
  @@index([badgeId])
  @@map("user_sin_badges")
}

model SinChallenge {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  sinType     SinType?
  targetDays  Int
  maxSins     Int
  xpReward    Int      @default(0)
  coinReward  Int      @default(0)
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  participants UserSinChallenge[]

  @@index([isActive, startDate, endDate])
  @@map("sin_challenges")
}

model UserSinChallenge {
  id          String       @id @default(cuid())
  userId      String
  challengeId String
  progress    Int          @default(0)
  completed   Boolean      @default(false)
  completedAt DateTime?
  joinedAt    DateTime     @default(now())
  challenge   SinChallenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, challengeId])
  @@index([userId, completed])
  @@index([challengeId])
  @@map("user_sin_challenges")
}

model SinWeeklySummary {
  id           String   @id @default(cuid())
  userId       String
  weekStart    DateTime
  weekEnd      DateTime
  totalSins    Int      @default(0)
  cleanDays    Int      @default(0)
  mostCommonSin SinType?
  sinBreakdown String?  @db.Text
  aiSummary    String?  @db.Text
  motivationBar Int     @default(0)
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, weekStart])
  @@index([userId, weekStart])
  @@map("sin_weekly_summaries")
}

enum SinType {
  tatli
  fastfood
  gazli
  alkol
  diger
}
