openapi: 3.0.3
info:
  title: Ä°tiraf DuvarÄ± API
  description: |
    Yeme GÃ¼nahÄ± Ä°tiraf DuvarÄ± API dokÃ¼mantasyonu.
    
    KullanÄ±cÄ±lar anonim itiraflar paylaÅŸabilir, AI destekli yanÄ±tlar alabilir ve topluluktan empati gÃ¶sterebilir.
    
    ## Authentication
    API, NextAuth session-based authentication kullanÄ±r. TÃ¼m endpoint'ler iÃ§in geÃ§erli bir session cookie gereklidir.
    
    ## Rate Limiting
    - Ä°tiraf oluÅŸturma: 3/gÃ¼n per user
    - Empati gÃ¶sterme: 100/saat per user
    - Rapor etme: 10/gÃ¼n per user
    - Genel API: 100 req/dakika per IP
  version: 1.0.0
  contact:
    email: api-support@yourdomain.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://yourdomain.com/api/v1
    description: Production server
  - url: http://localhost:3000/api/v1
    description: Development server

tags:
  - name: Confessions
    description: Ä°tiraf yÃ¶netimi endpoint'leri
  - name: Empathy
    description: Empati gÃ¶sterme endpoint'leri
  - name: Admin
    description: Admin yÃ¶netim endpoint'leri

paths:
  /confessions:
    get:
      tags:
        - Confessions
      summary: Ä°tiraf listesi
      description: Ä°tiraflarÄ± listeler, filtreleme ve sayfalama destekler
      operationId: getConfessions
      parameters:
        - name: page
          in: query
          description: Sayfa numarasÄ±
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Sayfa baÅŸÄ±na kayÄ±t sayÄ±sÄ±
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
        - name: category
          in: query
          description: Kategori filtresi
          schema:
            $ref: '#/components/schemas/ConfessionCategory'
        - name: popular
          in: query
          description: Sadece popÃ¼ler itiraflarÄ± gÃ¶ster
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Confession'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionAuth: []

    post:
      tags:
        - Confessions
      summary: Yeni itiraf oluÅŸtur
      description: Yeni bir itiraf oluÅŸturur. AI otomatik olarak yanÄ±t Ã¼retir.
      operationId: createConfession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  minLength: 10
                  maxLength: 500
                  description: Ä°tiraf metni
                  example: "DÃ¼n gece buzdolabÄ±na gittim ve yarÄ±m kilo dondurma bitirdim..."
                category:
                  $ref: '#/components/schemas/ConfessionCategory'
      responses:
        '201':
          description: Ä°tiraf baÅŸarÄ±yla oluÅŸturuldu
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      confession:
                        $ref: '#/components/schemas/Confession'
                      rewards:
                        type: object
                        properties:
                          xp:
                            type: integer
                            example: 10
                          coins:
                            type: integer
                            example: 5
                          badges:
                            type: array
                            items:
                              type: string
                            example: ["confession_first"]
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
      security:
        - sessionAuth: []

  /confessions/{id}:
    get:
      tags:
        - Confessions
      summary: Tekil itiraf detayÄ±
      description: Belirli bir itirafÄ±n detaylarÄ±nÄ± getirir
      operationId: getConfessionById
      parameters:
        - name: id
          in: path
          required: true
          description: Ä°tiraf ID'si
          schema:
            type: string
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Confession'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionAuth: []

  /confessions/{id}/empathy:
    post:
      tags:
        - Empathy
      summary: Empati gÃ¶ster
      description: Bir itirafa "Benimki de vardÄ±" diyerek empati gÃ¶sterir
      operationId: addEmpathy
      parameters:
        - name: id
          in: path
          required: true
          description: Ä°tiraf ID'si
          schema:
            type: string
      responses:
        '200':
          description: Empati baÅŸarÄ±yla eklendi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      empathyCount:
                        type: integer
                        example: 43
                      xpEarned:
                        type: integer
                        example: 2
                      badges:
                        type: array
                        items:
                          type: string
        '400':
          description: Zaten empati gÃ¶sterilmiÅŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  code: "ALREADY_EMPATHIZED"
                  message: "Bu itirafa zaten empati gÃ¶sterdiniz"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

    delete:
      tags:
        - Empathy
      summary: Empatiyi geri al
      description: Daha Ã¶nce gÃ¶sterilen empatiyi geri alÄ±r
      operationId: removeEmpathy
      parameters:
        - name: id
          in: path
          required: true
          description: Ä°tiraf ID'si
          schema:
            type: string
      responses:
        '200':
          description: Empati baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      empathyCount:
                        type: integer
                        example: 42
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

  /confessions/{id}/report:
    post:
      tags:
        - Confessions
      summary: Ä°tiraf raporla
      description: Uygunsuz iÃ§erik iÃ§eren bir itirafÄ± raporlar
      operationId: reportConfession
      parameters:
        - name: id
          in: path
          required: true
          description: Ä°tiraf ID'si
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: Rapor nedeni
                  example: "Uygunsuz dil kullanÄ±mÄ±"
      responses:
        '200':
          description: Rapor alÄ±ndÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Rapor alÄ±ndÄ±, inceleme yapÄ±lacak"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

  /confessions/my:
    get:
      tags:
        - Confessions
      summary: KullanÄ±cÄ±nÄ±n itiraflarÄ±
      description: GiriÅŸ yapan kullanÄ±cÄ±nÄ±n kendi itiraflarÄ±nÄ± listeler
      operationId: getMyConfessions
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Confession'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
                      stats:
                        type: object
                        properties:
                          totalConfessions:
                            type: integer
                          totalEmpathy:
                            type: integer
                          mostPopular:
                            type: object
                            properties:
                              id:
                                type: string
                              empathyCount:
                                type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionAuth: []

  /confessions/{id}/telafi/accept:
    post:
      tags:
        - Confessions
      summary: Telafi planÄ±nÄ± kabul et
      description: AI'Ä±n Ã¶nerdiÄŸi telafi planÄ±nÄ± kabul eder ve gÃ¼nlÃ¼k gÃ¶revlere ekler
      operationId: acceptTelafi
      parameters:
        - name: id
          in: path
          required: true
          description: Ä°tiraf ID'si
          schema:
            type: string
      responses:
        '200':
          description: Telafi planÄ± kabul edildi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      questAdded:
                        type: boolean
                        example: true
                      quest:
                        type: object
                        properties:
                          id:
                            type: string
                          title:
                            type: string
                          xpReward:
                            type: integer
                          type:
                            type: string
                            example: "telafi"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

  /confessions/stats:
    get:
      tags:
        - Confessions
      summary: Genel istatistikler
      description: Ä°tiraf sistemi hakkÄ±nda genel istatistikler
      operationId: getConfessionStats
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      totalConfessions:
                        type: integer
                        example: 1547
                      categoryBreakdown:
                        type: object
                        additionalProperties:
                          type: integer
                      averageEmpathy:
                        type: number
                        format: float
                        example: 23.4
                      popularConfessions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Confession'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionAuth: []

  /admin/confessions/moderation:
    get:
      tags:
        - Admin
      summary: Moderasyon kuyruÄŸu
      description: Onay bekleyen itiraflarÄ± listeler (Admin only)
      operationId: getModerationQueue
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/Confession'
                            - type: object
                              properties:
                                user:
                                  type: object
                                  properties:
                                    username:
                                      type: string
                                    email:
                                      type: string
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - sessionAuth: []

  /admin/confessions/{id}/approve:
    post:
      tags:
        - Admin
      summary: Ä°tirafÄ± onayla
      description: Pending durumundaki bir itirafÄ± onaylar (Admin only)
      operationId: approveConfession
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ä°tiraf onaylandÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Ä°tiraf onaylandÄ± ve yayÄ±nlandÄ±"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

  /admin/confessions/{id}/reject:
    post:
      tags:
        - Admin
      summary: Ä°tirafÄ± reddet
      description: Pending durumundaki bir itirafÄ± reddeder (Admin only)
      operationId: rejectConfession
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: Reddetme nedeni
                  example: "Uygunsuz iÃ§erik - Topluluk kurallarÄ±na aykÄ±rÄ±"
      responses:
        '200':
          description: Ä°tiraf reddedildi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Ä°tiraf reddedildi, kullanÄ±cÄ±ya bildirim gÃ¶nderildi"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

  /admin/confessions/reports:
    get:
      tags:
        - Admin
      summary: Rapor edilen itiraflar
      description: KullanÄ±cÄ±lar tarafÄ±ndan rapor edilen itiraflarÄ± listeler (Admin only)
      operationId: getReportedConfessions
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        confession:
                          $ref: '#/components/schemas/Confession'
                        reportCount:
                          type: integer
                        reports:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                              userId:
                                type: string
                              reason:
                                type: string
                              createdAt:
                                type: string
                                format: date-time
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - sessionAuth: []

  /admin/confessions/analytics:
    get:
      tags:
        - Admin
      summary: Analitik dashboard
      description: DetaylÄ± analitik veriler (Admin only)
      operationId: getAnalytics
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: BaÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      dailyStats:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              format: date
                            count:
                              type: integer
                            empathyCount:
                              type: integer
                      categoryDistribution:
                        type: object
                        additionalProperties:
                          type: integer
                      aiResponseSuccessRate:
                        type: number
                        format: float
                      averageResponseTime:
                        type: number
                        format: float
                      telafiAcceptanceRate:
                        type: number
                        format: float
                      topConfessions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Confession'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - sessionAuth: []

  /admin/seasonal-themes:
    post:
      tags:
        - Admin
      summary: Sezonluk tema oluÅŸtur
      description: Yeni bir sezonluk tema oluÅŸturur (Admin only)
      operationId: createSeasonalTheme
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - category
                - icon
                - startDate
                - endDate
              properties:
                name:
                  type: string
                  example: "Ramazan 2026"
                category:
                  type: string
                  example: "seasonal"
                icon:
                  type: string
                  example: "ðŸŒ™"
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
      responses:
        '201':
          description: Tema oluÅŸturuldu
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SeasonalTheme'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - sessionAuth: []

  /admin/seasonal-themes/{id}:
    put:
      tags:
        - Admin
      summary: Sezonluk tema gÃ¼ncelle
      description: Mevcut bir sezonluk temayÄ± gÃ¼nceller (Admin only)
      operationId: updateSeasonalTheme
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                isActive:
                  type: boolean
      responses:
        '200':
          description: Tema gÃ¼ncellendi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SeasonalTheme'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionAuth: []

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: next-auth.session-token
      description: NextAuth session cookie

  schemas:
    Confession:
      type: object
      properties:
        id:
          type: string
          example: "clx123abc"
        content:
          type: string
          example: "DÃ¼n gece buzdolabÄ±na gittim ve yarÄ±m kilo dondurma bitirdim..."
        category:
          $ref: '#/components/schemas/ConfessionCategory'
        aiResponse:
          type: string
          nullable: true
          example: "Gece saldÄ±rÄ±larÄ± hepimizin baÅŸÄ±na gelir! Ã–nemli olan bunun bir alÄ±ÅŸkanlÄ±k haline gelmemesi."
        aiTone:
          $ref: '#/components/schemas/AITone'
        telafiBudget:
          type: object
          nullable: true
          properties:
            action:
              type: string
            xpReward:
              type: integer
        empathyCount:
          type: integer
          example: 42
        isPopular:
          type: boolean
          example: false
        status:
          $ref: '#/components/schemas/ConfessionStatus'
        createdAt:
          type: string
          format: date-time
        hasEmpathized:
          type: boolean
          description: KullanÄ±cÄ±nÄ±n bu itirafa empati gÃ¶sterip gÃ¶stermediÄŸi
          example: false

    ConfessionCategory:
      type: string
      enum:
        - night_attack
        - special_occasion
        - stress_eating
        - social_pressure
        - no_regrets
        - seasonal
      example: night_attack

    AITone:
      type: string
      enum:
        - empathetic
        - humorous
        - motivational
        - realistic
      example: empathetic

    ConfessionStatus:
      type: string
      enum:
        - pending
        - published
        - rejected
        - hidden
      example: published

    SeasonalTheme:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        icon:
          type: string
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 156
        totalPages:
          type: integer
          example: 8
        hasMore:
          type: boolean
          example: true

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string

  responses:
    Unauthorized:
      description: Yetkisiz eriÅŸim
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "UNAUTHORIZED"
              message: "Bu iÅŸlem iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z"

    Forbidden:
      description: EriÅŸim yasak (Admin gerekli)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "FORBIDDEN"
              message: "Bu iÅŸlem iÃ§in admin yetkisi gereklidir"

    NotFound:
      description: Kaynak bulunamadÄ±
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "CONFESSION_NOT_FOUND"
              message: "Ä°tiraf bulunamadÄ±"

    ValidationError:
      description: Validasyon hatasÄ±
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            tooShort:
              value:
                success: false
                error:
                  code: "CONTENT_TOO_SHORT"
                  message: "Ä°tiraf en az 10 karakter olmalÄ±"
            tooLong:
              value:
                success: false
                error:
                  code: "CONTENT_TOO_LONG"
                  message: "Ä°tiraf en fazla 500 karakter olabilir"

    RateLimitExceeded:
      description: Rate limit aÅŸÄ±ldÄ±
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "DAILY_LIMIT_EXCEEDED"
              message: "GÃ¼nlÃ¼k itiraf limitine ulaÅŸtÄ±nÄ±z (3/3). YarÄ±n tekrar deneyin."
